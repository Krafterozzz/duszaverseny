<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="stylesschool.css">
    <script src="localstorage.js"></script>
    <title>Verseny Kateg√≥ria kezel√©se</title>
</head>
<body>
    <div class="container">
        <button id="dark-mode-toggle">üåô</button>
        <h1>Verseny kateg√≥ri√°k szerkeszt√©se</h1>
        
        <button id="addCategoryBtn" class="add-btn">√öj kateg√≥ria hozz√°ad√°sa</button>
        <br>
        <br>
        <h2>Kateg√≥ri√°k List√°ja</h2>
        
        <table id="categories-table">
            <thead>
                <tr>
                    <th>Kateg√≥ria neve</th>
                    <th>M≈±veletek</th>
                </tr>
            </thead>
            <tbody id="categories-body">
            </tbody>
        </table>
        <div id="message"></div>
        <br>
        <form action="logoutadmin.php" method="post">
            <button type="submit">Kijelentkez√©s</button>
        </form>

        <!-- Dialog boxes inside container -->
        <div class="overlay" id="editOverlay"></div>
        <div class="confirmation-dialog" id="editDialog">
            <h3>Kateg√≥ria szerkeszt√©se</h3>
            <input type="text" id="editCategoryName" placeholder="Kateg√≥ria neve">
            <br><br>
            <button id="confirmEdit" class="edit-btn">Ment√©s</button>
            <button id="cancelEdit">M√©gse</button>
        </div>

        <div class="overlay" id="deleteOverlay"></div>
        <div class="confirmation-dialog" id="deleteDialog">
            <h3>Meger≈ës√≠t√©s</h3>
            <p>Biztosan t√∂r√∂lni szeretn√© ezt a kateg√≥ri√°t?</p>
            <br>
            <button id="confirmDelete" class="delete-btn">T√∂rl√©s</button>
            <button id="cancelDelete">M√©gse</button>
        </div>

        <div class="overlay" id="addOverlay"></div>
        <div class="confirmation-dialog" id="addDialog">
            <h3>√öj kateg√≥ria hozz√°ad√°sa</h3>
            <input type="text" id="newCategoryName" placeholder="Kateg√≥ria neve">
            <br><br>
            <button id="confirmAdd" class="add-btn">Hozz√°ad√°s</button>
            <button id="cancelAdd">M√©gse</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const body = document.body;
    let currentActionId = null;

    // S√∂t√©t m√≥d kezel√©se
    const darkMode = localStorage.getItem('darkMode') === 'enabled';
    if (darkMode) {
        body.classList.add('dark-mode');
        darkModeToggle.textContent = '‚òÄÔ∏è';
    }

    darkModeToggle.addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        if (body.classList.contains('dark-mode')) {
            localStorage.setItem('darkMode', 'enabled');
            darkModeToggle.textContent = '‚òÄÔ∏è';
        } else {
            localStorage.setItem('darkMode', null);
            darkModeToggle.textContent = 'üåô';
        }
    });

    // √úzenet megjelen√≠t√©se
    function showMessage(message, type) {
        const messageDiv = document.getElementById("message");
        messageDiv.innerText = message;
        messageDiv.className = type;
        messageDiv.style.display = 'block';
        setTimeout(() => {
            messageDiv.style.display = 'none';
            messageDiv.className = '';
        }, 3000);
    }

    // Dial√≥gus megjelen√≠t≈ë f√ºggv√©nyek
    function showEditDialog(id, currentName) {
        currentActionId = id;
        document.getElementById('editCategoryName').value = currentName;
        document.getElementById('editOverlay').style.display = 'block';
        document.getElementById('editDialog').style.display = 'block';
    }

    function showDeleteDialog(id) {
        currentActionId = id;
        document.getElementById('deleteOverlay').style.display = 'block';
        document.getElementById('deleteDialog').style.display = 'block';
    }

    function showAddDialog() {
        document.getElementById('addOverlay').style.display = 'block';
        document.getElementById('addDialog').style.display = 'block';
        document.getElementById('newCategoryName').value = '';
    }

    // Dial√≥gus elrejt≈ë f√ºggv√©nyek
    function hideEditDialog() {
        document.getElementById('editOverlay').style.display = 'none';
        document.getElementById('editDialog').style.display = 'none';
        currentActionId = null;
    }

    function hideDeleteDialog() {
        document.getElementById('deleteOverlay').style.display = 'none';
        document.getElementById('deleteDialog').style.display = 'none';
        currentActionId = null;
    }

    function hideAddDialog() {
        document.getElementById('addOverlay').style.display = 'none';
        document.getElementById('addDialog').style.display = 'none';
    }

    // Kateg√≥ri√°k bet√∂lt√©se
    function loadCategories() {
        fetch("get_categories.php", {
            method: 'GET',
            credentials: 'include'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const tableBody = document.getElementById("categories-body");
                tableBody.innerHTML = "";
                data.categories.forEach(category => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${category.name}</td>
                        <td class="action-buttons">
                            <button class="edit-btn" onclick="showEditDialog(${category.id}, '${category.name}')">
                                Szerkeszt√©s
                            </button>
                            <button class="delete-btn" onclick="showDeleteDialog(${category.id})">
                                T√∂rl√©s
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } else {
                showMessage(data.message || "Hiba t√∂rt√©nt az adatok bet√∂lt√©se sor√°n.", "error");
            }
        })
        .catch(error => {
            console.error("Hiba:", error);
            showMessage("Hiba t√∂rt√©nt az adatok bet√∂lt√©se sor√°n.", "error");
        });
    }

    // Kateg√≥ria hozz√°ad√°sa
    document.getElementById('confirmAdd').addEventListener('click', () => {
        const name = document.getElementById('newCategoryName').value;
        fetch('add_category.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ name }),
            credentials: 'include'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                loadCategories();
                showMessage("Kateg√≥ria sikeresen hozz√°adva!", "success");
            } else {
                showMessage(data.message || "Hiba t√∂rt√©nt a hozz√°ad√°s sor√°n.", "error");
            }
            hideAddDialog();
        })
        .catch(error => {
            console.error("Hiba:", error);
            showMessage("Hiba t√∂rt√©nt a hozz√°ad√°s sor√°n.", "error");
            hideAddDialog();
        });
    });

    // Kateg√≥ria szerkeszt√©se
    document.getElementById('confirmEdit').addEventListener('click', () => {
        const name = document.getElementById('editCategoryName').value;
        fetch('update_category.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: currentActionId, name }),
            credentials: 'include'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                loadCategories();
                showMessage("Kateg√≥ria sikeresen m√≥dos√≠tva!", "success");
            } else {
                showMessage(data.message || "Hiba t√∂rt√©nt a m√≥dos√≠t√°s sor√°n.", "error");
            }
            hideEditDialog();
        })
        .catch(error => {
            console.error("Hiba:", error);
            showMessage("Hiba t√∂rt√©nt a m√≥dos√≠t√°s sor√°n.", "error");
            hideEditDialog();
        });
    });

    // Kateg√≥ria t√∂rl√©se
    document.getElementById('confirmDelete').addEventListener('click', () => {
        fetch('delete_category.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: currentActionId }),
            credentials: 'include'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                loadCategories();
                showMessage("Kateg√≥ria sikeresen t√∂r√∂lve!", "success");
            } else {
                showMessage(data.message || "Hiba t√∂rt√©nt a t√∂rl√©s sor√°n.", "error");
            }
            hideDeleteDialog();
        })
        .catch(error => {
            console.error("Hiba:", error);
            showMessage("Hiba t√∂rt√©nt a t√∂rl√©s sor√°n.", "error");
            hideDeleteDialog();
        });
    });

    // Dial√≥gus kezel≈ëk
    document.getElementById('addCategoryBtn').addEventListener('click', showAddDialog);
    document.getElementById('cancelAdd').addEventListener('click', hideAddDialog);
    document.getElementById('cancelEdit').addEventListener('click', hideEditDialog);
    document.getElementById('cancelDelete').addEventListener('click', hideDeleteDialog);

    // Kezdeti bet√∂lt√©s
    loadCategories();
    window.showEditDialog = showEditDialog;
    window.showDeleteDialog = showDeleteDialog;
});

    </script>
</body>
</html>