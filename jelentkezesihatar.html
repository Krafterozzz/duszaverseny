<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="stylesdeadline.css">
    <title>Jelentkez√©si hat√°rid≈ë</title>
</head>
<body>
    <div class="container">
        <button id="dark-mode-toggle">üåô</button>
        <h2>Jelentkez√©si hat√°rid≈ë</h2>
        <br>

 <div class="section">
   
    <form id="deadline-form">
        <label for="deadline">Jelentkez√©si hat√°rid≈ë:</label>
        <input type="datetime-local" id="deadline" name="deadline" required>
        <button type="submit">M√≥dos√≠t√°s</button>
    </form>
    <br>
    <p id="current-deadline">Jelenlegi hat√°rid≈ë:PLACEHOLDER</p>


</div>
<div class="message" id="message"></div>
<br>
<button id="close-registration" class="warning">Jelentkez√©s lez√°r√°sa</button>
        
<div style="height: 20px;"></div>

<form action="logoutadmin.php" method="post">
    <button type="submit">Kijelentkez√©s</button>
</form>
    </div> 
    <script src="dark-mode.js"></script>
    <script>

let clickCount = 0; // Kattint√°sok sz√°ml√°l√≥ja

document.getElementById("close-registration").addEventListener("click", function() {
  clickCount++; // N√∂veli a kattint√°ssz√°ml√°l√≥t
  if (clickCount < 3) {
    document.getElementById("message").innerText = `M√©g ${3 - clickCount} kattint√°s sz√ºks√©ges a lez√°r√°shoz.`;
  } else {
    document.getElementById("message").innerText = "A jelentkez√©s lez√°rva!";
    document.getElementById("close-registration").disabled = true; // Gomb letilt√°sa lez√°r√°s ut√°n
  }
});


   document.addEventListener("DOMContentLoaded", function() {
    const deadlineForm = document.getElementById("deadline-form");
    const deadlineInput = document.getElementById("deadline");
    const currentDeadlineElement = document.getElementById("current-deadline");
    const messageElement = document.getElementById("message");

    // Fetch the current deadline when the page loads
    fetchDeadline();

    // Function to fetch the current registration deadline
    function fetchDeadline() {
        fetch("get_deadline.php")
            .then(response => response.json())
            .then(data => {
                if (data.deadline) {
                    // Convert the deadline to a local date format
                    const formattedDeadline = new Date(data.deadline).toLocaleString();
                    currentDeadlineElement.innerHTML = `Jelenlegi hat√°rid≈ë: ${formattedDeadline}`;
                } else {
                    currentDeadlineElement.innerHTML = "Jelenlegi hat√°rid≈ë: Nincs be√°ll√≠tva.";
                }
            })
            .catch(error => {
                currentDeadlineElement.innerHTML = "Hiba t√∂rt√©nt a hat√°rid≈ë lek√©r√©se sor√°n.";
                console.error('Error fetching deadline:', error);
            });
    }

    // Handle form submission to update the deadline
    deadlineForm.addEventListener("submit", function(event) {
        event.preventDefault();

        const newDeadline = deadlineInput.value;
        
        const formData = new FormData();
        formData.append("deadline", newDeadline);

        fetch("update_deadline.php", {
            method: "POST",
            body: formData
        })
        .then(response => response.text())
        .then(message => {
            messageElement.innerHTML = message;
            fetchDeadline(); // Refresh the current deadline after update
        })
        .catch(error => {
            messageElement.innerHTML = "Hiba t√∂rt√©nt a friss√≠t√©s sor√°n.";
            console.error('Error updating deadline:', error);
        });
    });
});

    </script>
</body>
</html>

